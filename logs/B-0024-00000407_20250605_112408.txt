[2025-06-05 11:24:09] [INFO] Iniciando proceso ANULACIÓN
[2025-06-05 11:24:09] [INFO] Buscando datos del Local...
[2025-06-05 11:24:09] [DEBUG] ----- [REQUEST] -----
[2025-06-05 11:24:09] [DEBUG] URL: https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1
[2025-06-05 11:24:09] [DEBUG] Headers: {'X-POS-ID': 'Op_1111', 'Content-Type': 'application/json', 'Authorization': 'Bearer 8e4254f0-03d6-d1c8-9529-4be39effeec1'}
[2025-06-05 11:24:09] [DEBUG] Payload: None
[2025-06-05 11:24:09] [DEBUG] [RESPONSE JSON]: {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1', 'id': 'TGMXC47JK4HC1', 'name': 'Inforhard Servicios CLOVER', 'owner': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/employees/6R9FPGN093262', 'id': '6R9FPGN093262', 'orders': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/employees/6R9FPGN093262/orders'}}, 'address': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/address'}, 'merchantPlan': {'id': '75B8KFZ5B5K8W'}, 'createdTime': 1742216238000, 'gateway': {}, 'tenders': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/tenders'}, 'shifts': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/shifts'}, 'orders': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/orders'}, 'payments': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/payments'}, 'taxRates': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/tax_rates'}, 'printers': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/printers'}, 'modifierGroups': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/modifier_groups'}, 'orderTypes': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/order_types'}, 'reseller': {'id': 'SZGGG5RXYTAWE'}, 'opening_hours': {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/opening_hours'}}
[2025-06-05 11:24:09] [DEBUG] ----------------------
[2025-06-05 11:24:09] [INFO] Consultando URL directa: https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/address
[2025-06-05 11:24:10] [DEBUG] ----- [REQUEST] -----
[2025-06-05 11:24:10] [DEBUG] URL: https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/address
[2025-06-05 11:24:10] [DEBUG] Headers: {'X-POS-ID': 'Op_1111', 'Content-Type': 'application/json', 'Authorization': 'Bearer 8e4254f0-03d6-d1c8-9529-4be39effeec1'}
[2025-06-05 11:24:10] [DEBUG] Payload: None
[2025-06-05 11:24:10] [DEBUG] [RESPONSE JSON]: {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/address', 'address1': 'Santa Fe 197', 'city': 'Resistencia', 'country': 'AR', 'state': 'Chaco', 'zip': '3500'}
[2025-06-05 11:24:10] [DEBUG] ----------------------
[2025-06-05 11:24:10] [INFO] Buscando dispositivo...
[2025-06-05 11:24:11] [DEBUG] ----- [REQUEST] -----
[2025-06-05 11:24:11] [DEBUG] URL: https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/devices/
[2025-06-05 11:24:11] [DEBUG] Headers: {'X-POS-ID': 'Op_1111', 'Content-Type': 'application/json', 'Authorization': 'Bearer 8e4254f0-03d6-d1c8-9529-4be39effeec1'}
[2025-06-05 11:24:11] [DEBUG] Payload: None
[2025-06-05 11:24:11] [DEBUG] [RESPONSE JSON]: {'elements': [{'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/devices/ffec774e-d9fa-4d20-b713-c568fe97c701', 'id': 'ffec774e-d9fa-4d20-b713-c568fe97c701', 'model': 'unknown_Android SDK built for x86', 'merchant': {'id': 'TGMXC47JK4HC1'}, 'serial': 'EMULATOR35X2X10X0', 'secureId': '1dbbd2a2c40e8a7', 'buildType': 'USERDEBUG', 'deviceTypeName': 'OTHER'}, {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/devices/e4eebdad-047f-7b52-9c52-75382cf589ed', 'id': 'e4eebdad-047f-7b52-9c52-75382cf589ed', 'name': 'Op_1111', 'model': 'Clover_C406', 'merchant': {'id': 'TGMXC47JK4HC1'}, 'orderPrefix': '1', 'terminalPrefix': 1, 'serial': 'C046LT44741323', 'secureId': '97c6a3fb6d95a9fd', 'buildType': 'USER', 'deviceTypeName': 'FIGTREE', 'productName': 'Flex 4', 'pinDisabled': False, 'offlinePayments': False, 'offlinePaymentsAll': False}, {'href': 'https://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/devices/0b680a9d-57ef-45ba-8b92-c320887ddef6', 'id': '0b680a9d-57ef-45ba-8b92-c320887ddef6', 'name': 'REST API Test Device', 'model': 'Google_Android SDK built for x86', 'merchant': {'id': 'TGMXC47JK4HC1'}, 'orderPrefix': '0', 'terminalPrefix': 0, 'serial': '17fbb3ca30960cec', 'secureId': '17fbb3ca30960cec', 'buildType': 'USERDEBUG', 'deviceTypeName': 'OTHER', 'pinDisabled': False, 'offlinePayments': False, 'offlinePaymentsAll': False}], 'href': 'http://sandbox.dev.clover.com/v3/merchants/TGMXC47JK4HC1/devices'}
[2025-06-05 11:24:11] [DEBUG] ----------------------
[2025-06-05 11:24:11] [INFO] Buscando información de la venta B-0024-00000407
[2025-06-05 11:24:15] [DEBUG] ----- [REQUEST] -----
[2025-06-05 11:24:15] [DEBUG] URL: https://sandbox.dev.clover.com/connect/v1/payments/external/B-0024-00000407
[2025-06-05 11:24:15] [DEBUG] Headers: {'X-POS-ID': 'Op_1111', 'Content-Type': 'application/json', 'Authorization': 'Bearer 8e4254f0-03d6-d1c8-9529-4be39effeec1', 'X-Clover-Device-Id': 'C046LT44741323'}
[2025-06-05 11:24:15] [DEBUG] Payload: None
[2025-06-05 11:24:15] [DEBUG] [RESPONSE JSON]: {'payment': {'amount': 985325, 'attributes': {'tip_source': 'disabled', 'source_type': 'card_present', 'is_quick_chip': 'false'}, 'cardTransaction': {'authCode': '006014', 'cardType': 'VISA', 'cardholderName': '', 'currency': 'ars', 'entryType': 'EMV_CONTACTLESS', 'extra': {'cardSymbol': 'V1', 'processorReferenceNumber': '93274393274 ', 'approvalCode': 'Y:006014:309795052:PPXX:9327436354', 'transactionCertificate': '4DCBFFFF45B9EBED', 'cardType': 'VISA', 'mid': '64952761', 'terminalId': 'null', 'promotionalMessage': '{"message":"COBRA YA TUS VENTAS WWW.FIRSTDATA.COM.AR","showOnMerchantReceipt":true,"showOnCustomerReceipt":false,"showOnDisplay":false}', 'storeId': 'RCTST0000043694', 'cvmResult': 'NO_CVM_REQUIRED', 'applicationIdentifier': 'A0000000031010', 'tid': 'null', 'ipgEndpointId': 'TXSP ARGENTINA VIA CAFEX VISA', 'applicationLabel': '564953412050524550414944', 'receiptNumber': '6354', 'cardTypeLabel': 'VISA', 'installmentsNumber': '2', 'batchNumber': '001', 'ipgTxId': '8309795052'}, 'first6': '492115', 'last4': '2112', 'referenceId': 'AT6TABHKWJJ4Y', 'state': 'CLOSED', 'transactionNo': '100032', 'type': 'AUTH'}, 'cashbackAmount': 0, 'clientCreatedTime': 1749069199000, 'createdTime': 1749069199000, 'device': {'id': 'e4eebdad-047f-7b52-9c52-75382cf589ed'}, 'employee': {'id': '6R9FPGN093262'}, 'externalPaymentId': 'B-0024-00000407', 'id': 'AT6TABHKWJJ4Y', 'modifiedTime': 1749069198000, 'offline': False, 'order': {'id': 'AQ9NCXNA1AXEY'}, 'refunds': [{'amount': 985325, 'cardTransaction': {'authCode': '000000', 'cardType': 'VISA', 'currency': 'ars', 'extra': {'cardSymbol': 'V1', 'processorReferenceNumber': '80547780547 ', 'approvalCode': 'Y:371787:902315294:PPXX:8054776198', 'transactionCertificate': '57B5ACCAC49A4A30', 'cardType': 'VISA', 'mid': '98432715', 'promotionalMessage': '{"message":"COBRA YA TUS VENTAS WWW.FIRSTDATA.COM.AR","showOnMerchantReceipt":true,"showOnCustomerReceipt":false,"showOnDisplay":false}', 'cvmResult': 'NO_CVM_REQUIRED', 'applicationIdentifier': 'A0000000031010', 'tid': '58665484', 'ipgEndpointId': 'TXSP ARGENTINA VIA CAFEX VISA', 'applicationLabel': '564953412050524550414944', 'receiptNumber': '6198', 'cardTypeLabel': 'VISA', 'installmentsNumber': '2', 'batchNumber': '001', 'ipgTxId': '8902315294'}, 'last4': '2112', 'referenceId': 'AT6TABHKWJJ4Y', 'type': 'VOIDRETURN'}, 'createdTime': 1749069251000, 'device': {'id': 'e4eebdad-047f-7b52-9c52-75382cf589ed'}, 'employee': {'id': '6R9FPGN093262'}, 'id': 'E6Q4R35C0B8B0', 'orderRef': {'id': 'AQ9NCXNA1AXEY'}, 'payment': {'id': 'AT6TABHKWJJ4Y'}, 'taxAmount': 0, 'tipAmount': 0, 'voided': False}], 'result': 'SUCCESS', 'taxAmount': 0, 'tender': {'id': 'W175DKTTWB802', 'label': 'Tarjeta de crédito', 'labelKey': 'com.clover.tender.credit_card', 'opensCashDrawer': False}, 'tipAmount': 0}}
[2025-06-05 11:24:15] [DEBUG] ----------------------
[2025-06-05 11:24:18] [INFO] Enviando orden de devolución del pago AT6TABHKWJJ4Y
[2025-06-05 11:24:23] [WARNING] ❌ Fallo intento 1 al hacer request: 500 Server Error: Internal Server Error for url: https://sandbox.dev.clover.com/connect/v1/payments/AT6TABHKWJJ4Y/refunds
[2025-06-05 11:24:26] [WARNING] ❌ Fallo intento 2 al hacer request: 500 Server Error: Internal Server Error for url: https://sandbox.dev.clover.com/connect/v1/payments/AT6TABHKWJJ4Y/refunds
[2025-06-05 11:24:28] [WARNING] ❌ Fallo intento 3 al hacer request: 500 Server Error: Internal Server Error for url: https://sandbox.dev.clover.com/connect/v1/payments/AT6TABHKWJJ4Y/refunds
[2025-06-05 11:24:28] [DEBUG] ----- [REQUEST] -----
[2025-06-05 11:24:28] [DEBUG] URL: https://sandbox.dev.clover.com/connect/v1/payments/AT6TABHKWJJ4Y/refunds
[2025-06-05 11:24:28] [DEBUG] Headers: {'X-POS-ID': 'Op_1111', 'Content-Type': 'application/json', 'Authorization': 'Bearer 8e4254f0-03d6-d1c8-9529-4be39effeec1', 'X-Clover-Device-Id': 'C046LT44741323', 'Idempotency-Key': 'f7c8f51b-7b25-4c8d-aa4e-d621aa0d2ccc'}
[2025-06-05 11:24:28] [DEBUG] Payload: {'fullRefund': True}
[2025-06-05 11:24:28] [DEBUG] [RESPONSE JSON]: {'code': 'processing_error', 'message': 'Se canceló devolución. Se recibió un objeto de devolución nulo del dispositivo.', 'requestId': '99e5d4d7-275420', 'requestType': 'REFUND', 'type': 'api_error'}
[2025-06-05 11:24:28] [DEBUG] ----------------------
[2025-06-05 11:24:28] [ERROR] Error en refund_payment: 500 Server Error: Internal Server Error for url: https://sandbox.dev.clover.com/connect/v1/payments/AT6TABHKWJJ4Y/refunds
[2025-06-05 11:24:29] [INFO] Enviando pantalla de bienvenida...
[2025-06-05 11:24:31] [DEBUG] ----- [REQUEST] -----
[2025-06-05 11:24:31] [DEBUG] URL: https://sandbox.dev.clover.com/connect/v1/device/welcome
[2025-06-05 11:24:31] [DEBUG] Headers: {'X-POS-ID': 'Op_1111', 'Content-Type': 'application/json', 'Authorization': 'Bearer 8e4254f0-03d6-d1c8-9529-4be39effeec1', 'X-Clover-Device-Id': 'C046LT44741323', 'Idempotency-Key': 'f7c8f51b-7b25-4c8d-aa4e-d621aa0d2ccc'}
[2025-06-05 11:24:31] [DEBUG] Payload: None
[2025-06-05 11:24:31] [DEBUG] [RESPONSE JSON]: {}
[2025-06-05 11:24:31] [DEBUG] ----------------------
[2025-06-05 11:24:31] [INFO] Enviando pantalla de bienvenida...
[2025-06-05 11:24:32] [DEBUG] ----- [REQUEST] -----
[2025-06-05 11:24:32] [DEBUG] URL: https://sandbox.dev.clover.com/connect/v1/device/welcome
[2025-06-05 11:24:32] [DEBUG] Headers: {'X-POS-ID': 'Op_1111', 'Content-Type': 'application/json', 'Authorization': 'Bearer 8e4254f0-03d6-d1c8-9529-4be39effeec1', 'X-Clover-Device-Id': 'C046LT44741323', 'Idempotency-Key': 'f7c8f51b-7b25-4c8d-aa4e-d621aa0d2ccc'}
[2025-06-05 11:24:32] [DEBUG] Payload: None
[2025-06-05 11:24:32] [DEBUG] [RESPONSE JSON]: {}
[2025-06-05 11:24:32] [DEBUG] ----------------------
